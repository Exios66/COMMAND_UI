import{r as o,a as D,R as I}from"./vendor-wGySg1uH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function c(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=c(n);fetch(n.href,a)}})();var T={exports:{}},p={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B=o,L=Symbol.for("react.element"),U=Symbol.for("react.fragment"),A=Object.prototype.hasOwnProperty,W=B.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,q={key:!0,ref:!0,__self:!0,__source:!0};function k(s,t,c){var i,n={},a=null,l=null;c!==void 0&&(a=""+c),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(l=t.ref);for(i in t)A.call(t,i)&&!q.hasOwnProperty(i)&&(n[i]=t[i]);if(s&&s.defaultProps)for(i in t=s.defaultProps,t)n[i]===void 0&&(n[i]=t[i]);return{$$typeof:L,type:s,key:a,ref:l,props:n,_owner:W.current}}p.Fragment=U;p.jsx=k;p.jsxs=k;T.exports=p;var e=T.exports,N={},M=D;N.createRoot=M.createRoot,N.hydrateRoot=M.hydrateRoot;function d(s){const t=["B","KB","MB","GB","TB","PB"];let c=s,i=0;for(;c>=1024&&i<t.length-1;)c/=1024,i++;return i===0?`${Math.floor(c)}${t[i]}`:`${c.toFixed(1)}${t[i]}`}function z(s){s=Math.max(0,Math.floor(s));const t=s%60,c=Math.floor(s/60),i=c%60,n=Math.floor(c/60),a=n%24,l=Math.floor(n/24),h=j=>j.toString().padStart(2,"0");return l>0?`${l}d ${h(a)}:${h(i)}:${h(t)}`:`${h(a)}:${h(i)}:${h(t)}`}async function f(s){const t=await fetch(s);if(!t.ok)throw new Error(`${t.status} ${t.statusText}`);return await t.json()}const x={summary:()=>f("/api/summary"),processes:(s=25)=>f(`/api/processes?limit=${s}`),services:(s=25)=>f(`/api/services?limit=${s}`),diagnostics:(s=120)=>f(`/api/diagnostics?limit=${s}`),run:async s=>{const t=await fetch("/api/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cmd:s,timeout_s:120})}),c=await t.json().catch(()=>({}));if(!t.ok){const i=c&&c.detail||`${t.status} ${t.statusText}`;throw new Error(i)}return c}};function H(){const[s,t]=o.useState(null),[c,i]=o.useState([]),[n,a]=o.useState([]),[l,h]=o.useState([]),[j,g]=o.useState(null),[y,b]=o.useState(""),[m,_]=o.useState(null),[w,R]=o.useState(null),[E,S]=o.useState(!1),$=1e3;async function v(){try{g(null);const[r,u,C,F]=await Promise.all([x.summary(),x.processes(25),x.services(25),x.diagnostics(160)]);t(r),i(u.processes),a(C.services),h(F.lines)}catch(r){g(r.message)}}o.useEffect(()=>{v();const r=window.setInterval(v,$);return()=>window.clearInterval(r)},[]);const O=o.useMemo(()=>c.filter(r=>r.cpu>=25).slice(0,10),[c]);async function P(){const r=y.trim();if(r&&window.confirm(`Run this command?

${r}`)){S(!0),R(null),_(null);try{const u=await x.run(r);_(u),b("")}catch(u){R(u.message)}finally{S(!1)}}}return e.jsxs("div",{className:"wrap",children:[e.jsxs("header",{className:"header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"title",children:"DiagTerm Web"}),e.jsx("div",{className:"sub",children:"Live diagnostics + processes + services + command runner (localhost)"})]}),e.jsx("button",{className:"btn",onClick:v,children:"Refresh"})]}),j&&e.jsxs("div",{className:"alert",children:["API error: ",j]}),e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"cardTitle",children:"System"}),s?e.jsxs("div",{className:"grid",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Host"}),": ",s.hostname]}),e.jsxs("div",{children:[e.jsx("b",{children:"OS"}),": ",s.platform]}),e.jsxs("div",{children:[e.jsx("b",{children:"Uptime"}),": ",z(s.uptime_s)]}),e.jsxs("div",{children:[e.jsx("b",{children:"Load"}),": ",s.loadavg?s.loadavg.map(r=>r.toFixed(2)).join(" "):"N/A"]}),e.jsxs("div",{children:[e.jsx("b",{children:"CPU"}),": ",s.cpu_percent.toFixed(1),"%",s.cpu_freq_mhz?` @ ${s.cpu_freq_mhz.toFixed(0)}MHz`:""]}),e.jsxs("div",{children:[e.jsx("b",{children:"Package power"}),": ",s.package_power_w==null?"N/A":`${s.package_power_w.toFixed(1)} W`]}),e.jsxs("div",{children:[e.jsx("b",{children:"RAM"}),": ",d(s.mem_used)," / ",d(s.mem_total)," (avail ",d(s.mem_available),")"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Swap"}),": ",d(s.swap_used)," / ",d(s.swap_total)]}),e.jsxs("div",{children:[e.jsx("b",{children:"Disk(/)"}),": ",d(s.disk_used)," / ",d(s.disk_total)," (free ",d(s.disk_free),")"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Net"}),": ↑ ",d(s.net_sent)," | ↓ ",d(s.net_recv)]})]}):e.jsx("div",{className:"muted",children:"Loading…"})]}),e.jsxs("section",{className:"cols",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"cardTitle",children:"Diagnostics feed (warnings/errors)"}),e.jsx("pre",{className:"log",children:l.length?l.join(`
`):"(none / unavailable)"})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"cardTitle",children:'High CPU ("power")'}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"PID"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"CPU%"}),e.jsx("th",{children:"MEM%"})]})}),e.jsx("tbody",{children:O.length?O.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.pid}),e.jsx("td",{className:"mono",children:r.name}),e.jsx("td",{className:"mono",children:r.user??""}),e.jsx("td",{children:r.cpu.toFixed(1)}),e.jsx("td",{children:r.mem.toFixed(1)})]},r.pid)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"muted",children:"No high-CPU processes right now."})})})]})]})]}),e.jsxs("section",{className:"cols",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"cardTitle",children:"Top processes"}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"PID"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"CPU%"}),e.jsx("th",{children:"MEM%"}),e.jsx("th",{children:"IO R"}),e.jsx("th",{children:"IO W"})]})}),e.jsx("tbody",{children:c.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.pid}),e.jsx("td",{className:"mono",children:r.name}),e.jsx("td",{className:"mono",children:r.user??""}),e.jsx("td",{children:r.cpu.toFixed(1)}),e.jsx("td",{children:r.mem.toFixed(1)}),e.jsx("td",{className:"mono",children:r.read_b==null?"":d(r.read_b)}),e.jsx("td",{className:"mono",children:r.write_b==null?"":d(r.write_b)})]},r.pid))})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"cardTitle",children:"Running services (background operations)"}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Active"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:n.length?n.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"mono",children:r.name}),e.jsx("td",{children:r.active}),e.jsx("td",{children:r.description})]},r.name)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"muted",children:"(systemd unavailable)"})})})]})]})]}),e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"cardTitle",children:"Command runner"}),e.jsxs("div",{className:"muted",children:["Disabled by default on the backend. Enable with ",e.jsx("span",{className:"mono",children:"DIAGTERM_WEB_ENABLE_RUNNER=1"}),"."]}),e.jsxs("div",{className:"runner",children:[e.jsx("input",{className:"input",value:y,onChange:r=>b(r.target.value),placeholder:"Example: df -h && free -h",onKeyDown:r=>{r.key==="Enter"&&P()}}),e.jsx("button",{className:"btn",disabled:E,onClick:P,children:E?"Running…":"Run"})]}),w&&e.jsxs("div",{className:"alert",children:["Run error: ",w]}),m&&e.jsxs("div",{className:"runOut",children:[e.jsxs("div",{className:"mono",children:[e.jsx("b",{children:"$"})," ",m.cmd]}),e.jsxs("div",{className:"muted",children:["Exit code: ",m.returncode]}),m.stdout&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"stdout"}),e.jsx("pre",{className:"log",children:m.stdout})]}),m.stderr&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"muted",children:"stderr"}),e.jsx("pre",{className:"log",children:m.stderr})]})]})]}),e.jsxs("footer",{className:"footer",children:["Polling every ",Math.round($/100)/10,"s. Backend: ",e.jsx("span",{className:"mono",children:"127.0.0.1:8765"})]})]})}N.createRoot(document.getElementById("root")).render(e.jsx(I.StrictMode,{children:e.jsx(H,{})}));
